#!/bin/bash

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 8080..."
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 8080
if command -v lsof &> /dev/null; then
    echo "–ü—Ä–æ—Ü–µ—Å—Å—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ø–æ—Ä—Ç 8080:"
    sudo lsof -i :8080
elif command -v netstat &> /dev/null; then
    echo "–ü—Ä–æ—Ü–µ—Å—Å—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ø–æ—Ä—Ç 8080:"
    sudo netstat -tulpn | grep :8080
elif command -v ss &> /dev/null; then
    echo "–ü—Ä–æ—Ü–µ—Å—Å—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ø–æ—Ä—Ç 8080:"
    sudo ss -tulpn | grep :8080
else
    echo "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —É—Ç–∏–ª–∏—Ç—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Ä—Ç–∞"
fi

echo ""
echo "üí° –†–µ—à–µ–Ω–∏—è:"
echo "1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –ø–æ—Ä—Ç 8080"
echo "2. –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –≤ docker-compose.yml –Ω–∞ –¥—Ä—É–≥–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 8081)"
echo ""
read -p "–•–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –Ω–∞ 8081? (y/n): " CHANGE_PORT

if [[ "$CHANGE_PORT" =~ ^[Yy]$ ]]; then
    # –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
    cp docker-compose.yml docker-compose.yml.bak
    
    # –ó–∞–º–µ–Ω–∞ –ø–æ—Ä—Ç–∞ 8080 –Ω–∞ 8081
    if [[ "$OSTYPE" == "darwin"* ]]; then
        sed -i '' 's/"8080:8000"/"8081:8000"/g' docker-compose.yml
    else
        sed -i 's/"8080:8000"/"8081:8000"/g' docker-compose.yml
    fi
    
    echo "‚úÖ –ü–æ—Ä—Ç –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ 8081"
    echo "–¢–µ–ø–µ—Ä—å –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://–≤–∞—à_—Å–µ—Ä–≤–µ—Ä_ip:8081"
    echo ""
    echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞: docker compose up -d"
fi

